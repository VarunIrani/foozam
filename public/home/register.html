<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.webp">
  <link rel="manifest" href="manifest.json">
  <title>
    Foozam | Register
  </title>
  <!-- Preload -->
  <link href="../assets/js/core/jquery.min.js" rel="preload" as="script" />
  <link href="../assets/js/core/popper.min.js" rel="preload" as="script" />
  <link href="../assets/js/core/bootstrap.min.js" rel="preload" as="script" />
  <link rel="preload" href="../assets/js/plugins/perfect-scrollbar.jquery.min.js" as="script">
  <link rel="preload" href="../assets/js/plugins/bootstrap-switch.js" as="script">
  <link rel="preload" href="../assets/js/plugins/nouislider.min.js" as="script">
  <link rel="preload" href="../assets/js/plugins/chartjs.min.js" as="script">
  <link rel="preload" href="../assets/js/plugins/moment.min.js" as="script">
  <link rel="preload" href="../assets/js/plugins/bootstrap-datetimepicker.js" as="script">
  <link rel="preload" href="../assets/js/blk-design-system.min.js?v=1.0.0" as="script">

  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,600,700,800" rel="stylesheet" />
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="preload" as="style"/>
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="../assets/css/blk-design-system.css?v=1.0.0" rel="preload" as="style"/>
  <link href="../assets/css/blk-design-system.css?v=1.0.0" rel="stylesheet" />
</head>

<body class="register-page">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top navbar-transparent " color-on-scroll="100">
    <div class="container">
      <div class="navbar-translate">
        <a class="navbar-brand" href="index.html" rel="tooltip" title="Foozam Inc." data-placement="bottom"
          target="_blank">
          <span>Foozam</span>
        </a>
        <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-bar bar1"></span>
          <span class="navbar-toggler-bar bar2"></span>
          <span class="navbar-toggler-bar bar3"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse justify-content-end" id="navigation">
        <div class="navbar-collapse-header">
          <div class="row">
            <div class="col-6 collapse-brand">
              <a>
                Foozam
              </a>
            </div>
            <div class="col-6 collapse-close text-right">
              <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navigation"
                aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                <i class="tim-icons icon-simple-remove"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- End Navbar -->
  <div class="wrapper">
    <div class="page-header">
      <div class="page-header-image"></div>
      <div class="content">
        <div class="container">
          <div class="row">
            <div class="col-lg-5 col-md-6 offset-lg-0 offset-md-3">
              <div id="square7" class="square square-7"></div>
              <div id="square8" class="square square-8"></div>
              <div class="card card-register">
                <div class="card-header">
                  <img class="card-img" src="../assets/img/square1.jpg" alt="Card image">
                  <h4 class="card-title ml-1 mt-1" style="color: white">Register</h4>
                </div>
                <div class="card-body">
                  <form class="form">
                    <div class="input-group" id="fullNameInputGroup">
                      <div class="input-group-prepend">
                        <div class="input-group-text">
                          <i class="tim-icons icon-single-02"></i>
                        </div>
                      </div>
                      <input id="fullName" required type="text" class="form-control form-control-lg"
                        placeholder="Full Name">
                    </div>
                    <div class="input-group" id="emailInputGroup">
                      <div class="input-group-prepend">
                        <div class="input-group-text">
                          <i class="tim-icons icon-email-85"></i>
                        </div>
                      </div>
                      <input id="email" required type="text" placeholder="Email" class="form-control form-control-lg">
                    </div>
                    <div class="input-group" id="passwordInputGroup">
                      <div class="input-group-prepend">
                        <div class="input-group-text">
                          <i class="tim-icons icon-lock-circle"></i>
                        </div>
                      </div>
                      <input id="password" required type="password" class="form-control form-control-lg"
                        placeholder="Password">
                    </div>
                    <div class="form-check text-left">
                      <label class="form-check-label">
                        <input id="termsCheck" class="form-check-input" type="checkbox">
                        <span class="form-check-sign"></span>
                        I agree to the
                        <a href="javascript:void(0)">terms and conditions</a>.
                      </label>
                    </div>
                  </form>
                </div>
                <div class="card-footer">
                  <a href="javascript:void(0)" id="registerButton" class="btn btn-info btn-round btn-lg">Get Started</a>
                  <button id="errorModal" style="opacity: 0;" data-toggle="modal" data-target="#myModal2">Error
                    Modal</button>
                </div>
              </div>
            </div>
          </div>
          <div class="register-bg"></div>
          <div id="square1" class="square square-1"></div>
          <div id="square2" class="square square-2"></div>
          <div id="square3" class="square square-3"></div>
          <div id="square4" class="square square-4"></div>
          <div id="square5" class="square square-5"></div>
          <div id="square6" class="square square-6"></div>
        </div>
      </div>
      <div class="modal fade modal-black" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header justify-content-center">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                <i class="tim-icons icon-simple-remove text-white"></i>
              </button>
              <div class="text-muted text-center ml-auto mr-auto">
                <h3 class="mb-0">Welcome</h3>
              </div>
            </div>
            <div class="modal-body">

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="../assets/js/core/jquery.min.js" type="text/javascript" ></script>
  <script src="../assets/js/core/popper.min.js" type="text/javascript" ></script>
  <script src="../assets/js/core/bootstrap.min.js" type="text/javascript" ></script>
  <script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js" ></script>
  <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
  <script src="../assets/js/plugins/bootstrap-switch.js" ></script>
  <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
  <script src="../assets/js/plugins/nouislider.min.js" type="text/javascript" ></script>
  <!-- Chart JS -->
  <script src="../assets/js/plugins/chartjs.min.js" ></script>
  <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
  <script src="../assets/js/plugins/moment.min.js" ></script>
  <script src="../assets/js/plugins/bootstrap-datetimepicker.js" type="text/javascript" ></script>
  <!-- Control Center for Black UI Kit: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/blk-design-system.min.js?v=1.0.0" type="text/javascript" ></script>
  <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>

  <script type="module">
    const config = {
      apiKey: 'AIzaSyCK5tTuXD5WbHmhC-hBj-giHh3JLnb_fhE',
      authDomain: 'foozam-test.firebaseapp.com',
      databaseURL: 'https://foozam-test.firebaseio.com',
      projectId: 'foozam-test',
      storageBucket: '',
      messagingSenderId: '791490333729',
    };
    firebase.initializeApp(config);
    const $fullNameInput = $('#fullName');
    const $emailInput = $('#email');
    const $passwordInput = $('#password');

    function validPassword(password) {
      /*
      Strong passwords with min 8 - max 15 character length, at least two letters (not case sensitive), 
      one number, one special character (all, not just defined), space is not allowed.
      */
      const regex = /^(?=(.*[a-zA-Z].*){2,})(?=.*\d.*)(?=.*\W.*)[a-zA-Z0-9\S]{8,15}$/;
      return regex.test(password);
    }

    function isEmail(email) {
      const regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      return regex.test(email);
    }

    let fullName;
    let email;
    let password;
    let fullNameOK = false;
    let emailOK = false;
    let passwordOK = false;

    $fullNameInput.keyup(() => {
      fullName = $fullNameInput.val();
      if (fullName == '') {
        $('#fullNameInputGroup').removeClass('has-success');
        $('#fullNameInputGroup').addClass('has-danger');
        fullNameOK = false;
      }
      else if (fullName) {
        $('#fullNameInputGroup').removeClass('has-danger');
        $('#fullNameInputGroup').addClass('has-success');
        fullNameOK = true;
      }  
    });

    $emailInput.keyup(() => {
      email = $emailInput.val();
      if (isEmail(email)) {
        $('#emailInputGroup').addClass('has-success');
        $('#emailInputGroup').removeClass('has-danger');
        emailOK = true;
      } else {
        $('#emailInputGroup').removeClass('has-success');
        $('#emailInputGroup').addClass('has-danger');
        emailOK = false;
      }
    });

    $passwordInput.keyup(() => {
      password = $passwordInput.val();
      if (validPassword(password)) {
        $('#passwordInputGroup').addClass('has-success');
        $('#passwordInputGroup').removeClass('has-danger');
        passwordOK = true;
      } else {
        $('#passwordInputGroup').removeClass('has-success');
        $('#passwordInputGroup').addClass('has-danger');
        passwordOK = false;
      }
    });

    let user = {};

    function writeUserData(user) {
      const userRef = firebase.database().ref(`users/${user.uid}`);
      userRef.set(user);
    }

    function redirectToMain() {
      const userLoggedIn = parseInt(localStorage.getItem('userLoggedIn'));
      if (userLoggedIn)
        location.replace('../');
    }
    // Register Code
    function login() {
      firebase.auth().signInWithEmailAndPassword(email, password);
      firebase.auth().onAuthStateChanged((firebaseUser) => {
        if (firebaseUser) {
          user = {
            uid: firebaseUser.uid,
            displayName: fullName,
            email,
            phoneNumber: '',
            photoURL: '',
            providerId: 'password',
          }
          writeUserData(user);
          localStorage.setItem('loggedInUser', JSON.stringify(user));
          localStorage.setItem('userLoggedIn', '1');
          window.setTimeout(redirectToMain, 3000);
        }
      });
    }
    // Register Check
    $('#registerButton').on('click', () => {
      const termsCheck = document.getElementById('termsCheck').checked;
      if (termsCheck && fullNameOK && emailOK && passwordOK) {
        const auth = firebase.auth();
        auth.createUserWithEmailAndPassword(email, password)
          .catch((e) => console.log(e));
      }
      login();
    });
  </script>
</body>

</html>